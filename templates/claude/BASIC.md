# Claude プロジェクトガイド

このドキュメントは、このリポジトリにおいて
Claude がどのように振る舞うべきかを定義します。

特別な指示がない限り、以下のルールに従ってください。

**重要**: `.claude/CONTEXT.md` が存在する場合、必ず参照すること。
プロジェクト固有のコード規約・参照ドキュメント・変更禁止事項が記載されています。

---

## 0. ブランチ命名規則

ブランチ名は以下の形式に従います。

feature/<動詞>-<対象>

- kebab-case を使用する
- 動詞は明確な行動を表すものを使う
  （add, fix, update, remove, refactor, improve など）
- 1 ブランチ = 1 機能または 1 関心事

例：
- feature/add-healthcheck-api

並列作業を行う場合、役割サフィックスを付与してもよい：

- feature/add-healthcheck/api
- feature/add-healthcheck/ui

---

## 1. 開発スタイル

このプロジェクトは **plan 駆動開発**を採用します。

- 実装前に必ず `.claude/plans/` を確認する
- plan が存在する場合、**チャット文脈のみで実装してはいけない**

関連する plan がある場合：
→ plan ファイルを **唯一の正とする**

---

## 2. Plan の構成

plan は以下に配置されます：

.claude/plans/<feature>/

一般的な構成：

- `00_spec.md`
  - 不変の仕様書（要件・制約・データモデル）
  - 明示的な指示がない限り **変更してはいけない**

- `10_tasks.md`
  - タスク分解と担当範囲
  - 各タスクはスコープ・許可ファイル・完了条件を定義する

- `11_api_contract.md`（UI と API を並列実装する場合）
  - エンドポイント定義（メソッド・パス・ステータスコード）
  - リクエスト / レスポンスの型定義
  - UI・API 両方がこの契約に従って実装する

- `20_impl_*.md`
  - 役割ごとの実装指示（API / UI など）

- `30_review_test.md`
  - レビューチェックリスト・テスト方針・受け入れ条件

作業開始前に、必ず該当ファイルをすべて読むこと。

---

### Plan の粒度ルール（重要）

すべての変更に対して、常にフル構成の plan を要求しない。

Claude は変更内容の規模と影響範囲を判断し、
**必要最小限の plan 構成を選択すること。**

#### Small Changes（軽微修正）
対象例：
- UI の見た目調整
- 文言修正
- 単純な条件分岐・ロジック修正
- 影響範囲が限定的な変更

必要な plan：
- `00_spec.md`
- `10_tasks.md`

※ 実装指示（20_impl_*.md）やレビュー計画（30_review_test.md）は不要

---

#### Medium / Large Changes（中〜大規模変更）
対象例：
- 新機能追加
- API の追加・変更
- 複数レイヤ（UI / API）にまたがる変更
- 将来的な拡張を考慮する必要がある変更

必要な plan：
- `00_spec.md`
- `10_tasks.md`
- `11_api_contract.md`（UI / API 並列の場合）
- `20_impl_*.md`（役割ごと）
- `30_review_test.md`

---

Claude は、変更規模を過小評価せず、
**迷った場合は Medium / Large として扱うこと。**

---

## 3. 役割分離

Claude は以下の役割で利用されます。

- **仕様策定 / 計画**
- **実装（API / UI など）**
- **レビュー / テスト**

実装担当時のルール：

- 割り当てられた役割のみに集中する
- 定義されたスコープ外のファイルを変更しない
- 自己判断で仕様を再設計しない

不明点や矛盾がある場合：
→ 推測せず、質問または報告すること。

---

## 4. 並列開発ルール

このプロジェクトでは **git worktree** を用いた並列開発を行う場合があります。

前提：
- 各 worktree は 1 つの役割またはタスクに対応する
- 他の worktree でも同時に変更が行われている可能性がある

そのため：

- 関係のないファイルに触れない
- 大規模なリファクタは避ける
- 小さく、分離された変更を優先する

---

## 5. レビューと安全性

レビューまたはテスト担当時のルール：

- 機能の再実装を行わない
- 以下に集中する：
  - スコープ逸脱
  - リスクの高い変更
  - テスト不足
  - 既存スタイルとの不整合

フィードバックは以下の形式で行う：

- 何が変更されたか
- なぜリスクがあるか
- 具体的な改善提案

---

## 6. 一般原則

- 巧妙さより明確さを優先する
- 大きな変更より小さな変更を優先する
- 新しいやり方より既存パターンを尊重する

迷ったら：
→ 作業を止めて質問すること。
