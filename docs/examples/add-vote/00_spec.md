# 仕様書: add-vote

## 概要
Todo アプリの各タスクに「投票（いいね）」機能を追加する。
ユーザーは各タスクに対して 1 回だけ投票でき、投票数がタスク一覧に表示される。

## 背景
チーム内でタスクの優先度を可視化するため、メンバーが「このタスクは重要」と思うものに投票できる仕組みが求められている。

## 要件

### 機能要件
- ユーザーは各タスクに対して投票（いいね）できる
- 1 ユーザーにつき 1 タスクあたり 1 回まで
- 投票済みのタスクに再度クリックすると投票を取り消せる（トグル動作）
- タスク一覧に各タスクの投票数を表示する
- 自分が投票済みのタスクは視覚的に区別する

### 非機能要件
- 投票操作のレスポンスは 200ms 以内
- 楽観的 UI 更新（API レスポンスを待たずに UI を即時反映）

## データモデル

### votes テーブル（新規）
| カラム | 型 | 制約 |
|--------|------|------|
| id | UUID | PK |
| task_id | UUID | FK → tasks.id, NOT NULL |
| user_id | UUID | FK → users.id, NOT NULL |
| created_at | TIMESTAMP | NOT NULL, DEFAULT now() |

- `(task_id, user_id)` に UNIQUE 制約

### tasks テーブル（変更なし）
- votes テーブルから集計するため、tasks テーブルへのカラム追加は行わない

## 制約
- 既存のタスク CRUD 機能に影響を与えない
- 認証済みユーザーのみ投票可能（未認証ユーザーには投票ボタンを表示しない）
- DB マイグレーションは API 側の責務とする

## 用語
- **投票 / vote**: タスクに対する「いいね」操作
- **投票数 / vote count**: あるタスクに対する総投票数

---

## 検証チェックリスト
- [ ] 要件に漏れがないか（機能要件 / 非機能要件）
- [ ] データモデルが要件を満たしているか
- [ ] 制約が明確に定義されているか
- [ ] 用語の定義が一貫しているか
